# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#1-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞-–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π](#2-–¥–µ—Ç–∞–ª—å–Ω–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–º–æ–¥—É–ª–µ–π)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö](#3-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#4-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
5. [–ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#5-–ø–æ—ç—Ç–∞–ø–Ω—ã–π-–ø–ª–∞–Ω-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞](#6-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–æ—Ç–ª–∞–¥–∫–∞)
7. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è](#7-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–∏-—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1.1. –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ 30 –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö Telegram-—á–∞—Ç–æ–≤ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- –ê–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–µ–∫—Å—Ç + –≥–æ–ª–æ—Å–æ–≤—ã–µ) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤
- –°–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –±–µ–ª—ã–º —Å–ø–∏—Å–∫–æ–º
- –í—ã—è–≤–ª–µ–Ω–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é LLM
- –û—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

### 1.2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** (Separation of Concerns):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     TELEGRAM MONITOR SYSTEM                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ                     ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇCOLLECTOR‚îÇ          ‚îÇ  ANALYZER  ‚îÇ        ‚îÇ MANAGER  ‚îÇ
   ‚îÇ(Telethon‚îÇ          ‚îÇ (Core Logic‚îÇ        ‚îÇ (aiogram)‚îÇ
   ‚îÇ Userbot)‚îÇ          ‚îÇ    + LLM)  ‚îÇ        ‚îÇ   Bot)   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ                     ‚îÇ
        ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
        ‚îÇ    ‚îÇ                                  ‚îÇ   ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ STORAGE‚îÇ              ‚îÇ NOTIFIER    ‚îÇ
             ‚îÇ SQLite ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îÇ
             ‚îÇ+ Sheets‚îÇ              ‚îÇ   Admin     ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –†–æ–ª—å | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ |
|-----------|-----------|------|--------------|
| **Collector** | Telethon (MTProto) | –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö | –î–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏, –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| **Analyzer** | Python + LLM API | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | AI-–∞–Ω–∞–ª–∏–∑, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö |
| **Manager** | aiogram (Bot API) | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ö–æ–º–∞–Ω–¥—ã, –±–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –õ–° |
| **Storage** | SQLite + Google Sheets | –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è + –æ–±–ª–∞—á–Ω–∞—è –ø–∞–Ω–µ–ª—å |

### 1.3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

```python
# Python 3.11+
requirements = {
    "telegram": ["Telethon>=1.34.0", "aiogram>=3.4.0"],
    "async": ["APScheduler>=3.10.4", "aiohttp>=3.9.0"],
    "storage": ["gspread_asyncio>=1.4.0", "aiosqlite>=0.20.0"],
    "validation": ["pydantic>=2.6.0", "pydantic-settings>=2.2.0"],
    "utils": ["python-dotenv>=1.0.1", "loguru>=0.7.2"]
}
```

### 1.4. –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ò–∑–æ–ª—è—Ü–∏—è Userbot**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–∫–∫–∞—É–Ω—Ç (–Ω–µ –ª–∏—á–Ω—ã–π)
2. **Anti-Flood –∑–∞—â–∏—Ç–∞**: –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ 10-30 —Å–µ–∫ –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —á–∞—Ç–æ–≤
3. **Secrets management**: –í—Å–µ —Ç–æ–∫–µ–Ω—ã –≤ `.env`, –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git
4. **Graceful degradation**: SQLite –∫–∞–∫ –±—É—Ñ–µ—Ä –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Sheets

---

## 2. –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

### 2.1. –ú–æ–¥—É–ª—å Collector (Telethon Userbot)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–æ–ª—á–∞–ª–∏–≤—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ —á–∞—Ç–æ–≤ –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π

#### 2.1.1. –ö–ª–∞—Å—Å `TelethonCollector`

```python
# src/collector/client.py

class TelethonCollector:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Å—Å–∏–∏ Telethon –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —á–∞—Ç–æ–≤.
    
    –ê—Ç—Ä–∏–±—É—Ç—ã:
        client (TelegramClient): –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–µ–Ω—Ç Telethon
        session_path (Path): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–µ—Å—Å–∏–∏
        flood_protection (FloodProtection): –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–ª—É–¥–∞
    """
    
    def __init__(self, api_id: int, api_hash: str, phone: str):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
        
    async def start_session(self) -> None:
        """–ó–∞–ø—É—Å–∫ —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–≤–æ–¥–æ–º –∫–æ–¥–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ"""
        
    async def stop_session(self) -> None:
        """–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è"""
        
    async def health_check(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏)"""
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `telethon.TelegramClient`
- `config.settings.TelethonSettings`
- `utils.logger`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ `.env` (API_ID, API_HASH, PHONE)
- –§–∞–π–ª —Å–µ—Å—Å–∏–∏ `data/sessions/userbot.session`

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Telethon

---

#### 2.1.2. –ö–ª–∞—Å—Å `MessageHistoryCollector`

```python
# src/collector/history.py

class MessageHistoryCollector:
    """
    –°–±–æ—Ä—â–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —á–∞—Ç–æ–≤.
    
    –ú–µ—Ç–æ–¥—ã:
        collect_messages: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤
        download_voice: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        deduplicate: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ SQLite –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
    """
    
    async def collect_messages(
        self,
        chat_id: int,
        hours_back: int = 6,
        batch_size: int = 100
    ) -> List[MessageData]:
        """
        –°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏.
        
        –õ–æ–≥–∏–∫–∞:
        1. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ offset_date = now() - timedelta(hours=hours_back)
        2. –í—ã–∑–æ–≤ client.iter_messages(chat_id, offset_date=offset_date, limit=batch_size)
        3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
           - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/–º–µ–¥–∏–∞
           - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ message_id + chat_id)
           - –ï—Å–ª–∏ voice: –≤—ã–∑–æ–≤ download_voice()
        4. –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ MessageData
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            chat_id: ID —á–∞—Ç–∞
            hours_back: –ì–ª—É–±–∏–Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)
            batch_size: –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ –¥–ª—è iter_messages
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            List[MessageData]: –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            
        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
            FloodWaitError: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            ChatAdminRequiredError: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–ø—É—Å–∫ —á–∞—Ç–∞
        """
        
    async def download_voice(
        self,
        message: Message,
        timeout: int = 30,
        max_size_mb: int = 50
    ) -> Optional[Path]:
        """
        –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è.
        
        –õ–æ–≥–∏–∫–∞:
        1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞: message.voice.size <= max_size_mb * 1024 * 1024
        2. –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: data/temp/{chat_id}_{message_id}.ogg
        3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º: asyncio.wait_for(message.download_media(), timeout)
        4. –í–æ–∑–≤—Ä–∞—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telethon
            timeout: –¢–∞–π–º–∞—É—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            max_size_mb: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            Optional[Path]: –ü—É—Ç—å –∫ —Å–∫–∞—á–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É –∏–ª–∏ None
        """
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `telethon.client.TelegramClient`
- `storage.database.MessageRepository`
- `utils.flood_protection`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `chat_id`: ID —á–∞—Ç–∞ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `hours_back`: –ì–ª—É–±–∏–Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `List[MessageData]`: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –°–∫–∞—á–∞–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ `data/temp/`

---

#### 2.1.3. –ö–ª–∞—Å—Å `ParticipantCollector`

```python
# src/collector/participants.py

class ParticipantCollector:
    """
    –°–±–æ—Ä—â–∏–∫ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞.
    
    –ú–µ—Ç–æ–¥—ã:
        get_full_participants: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        compare_with_whitelist: –°–≤–µ—Ä–∫–∞ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º
    """
    
    async def get_full_participants(
        self, 
        chat_id: int
    ) -> List[ParticipantData]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ –≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö.
        
        –õ–æ–≥–∏–∫–∞:
        1. –í—ã–∑–æ–≤ client.get_participants(chat_id, limit=None, aggressive=True)
        2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ: user_id, username, first_name, last_name, is_bot
        3. –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ ParticipantData
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            chat_id: ID —á–∞—Ç–∞
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            List[ParticipantData]: –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        """
        
    async def compare_with_whitelist(
        self,
        chat_id: int,
        participants: List[ParticipantData],
        whitelist: List[int]
    ) -> ParticipantReport:
        """
        –°–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –±–µ–ª—ã–º —Å–ø–∏—Å–∫–æ–º.
        
        –õ–æ–≥–∏–∫–∞:
        1. –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤: current_ids = {p.user_id for p in participants}
        2. missing = set(whitelist) - current_ids (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å, –Ω–æ –∏—Ö –Ω–µ—Ç)
        3. extra = current_ids - set(whitelist) (–µ—Å—Ç—å, –Ω–æ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ)
        4. –í–æ–∑–≤—Ä–∞—Ç ParticipantReport —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            ParticipantReport: –û—Ç—á–µ—Ç —Å missing –∏ extra —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
        """
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `telethon.client.TelegramClient`
- `storage.sheets.WhitelistProvider`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `chat_id`: ID —á–∞—Ç–∞
- `whitelist`: –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö user_id –∏–∑ Google Sheets

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `ParticipantReport`: –û–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `missing` –∏ `extra`

---

### 2.2. –ú–æ–¥—É–ª—å Analyzer (Core Logic)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é LLM –∏ Whisper

#### 2.2.1. –ö–ª–∞—Å—Å `WhisperClient`

```python
# src/core/whisper.py

class WhisperClient:
    """
    –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —á–µ—Ä–µ–∑ CometAPI Whisper.
    
    –ê—Ç—Ä–∏–±—É—Ç—ã:
        api_key (str): –ö–ª—é—á API
        api_url (str): Endpoint –¥–ª—è Whisper
        session (aiohttp.ClientSession): HTTP —Å–µ—Å—Å–∏—è
    """
    
    async def transcribe_voice(
        self,
        audio_path: Path,
        language: str = "ru"
    ) -> TranscriptionResult:
        """
        –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
        
        –õ–æ–≥–∏–∫–∞:
        1. –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: audio_data = audio_path.read_bytes()
        2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ multipart/form-data –∑–∞–ø—Ä–æ—Å–∞
        3. POST –Ω–∞ {api_url}/v1/audio/transcriptions
        4. –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞: {"text": "...", "language": "ru", "duration": 12.5}
        5. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        6. –í–æ–∑–≤—Ä–∞—Ç TranscriptionResult
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            audio_path: –ü—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É (.ogg)
            language: –Ø–∑—ã–∫ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            TranscriptionResult: –û–±—ä–µ–∫—Ç —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
            
        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
            WhisperAPIError: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
        """
```

**API Endpoint**:
```http
POST https://api.comet.com/v1/audio/transcriptions
Content-Type: multipart/form-data
Authorization: Bearer {COMET_API_KEY}

{
  "file": <binary_data>,
  "model": "whisper-1",
  "language": "ru"
}
```

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
```json
{
  "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –∫–æ–ª–ª–µ–≥–∏. –•–æ—á—É –æ–±—Å—É–¥–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é.",
  "language": "ru",
  "duration": 8.3,
  "segments": [...]
}
```

---

#### 2.2.2. –ö–ª–∞—Å—Å `LLMClient`

```python
# src/core/llm_client.py

class LLMClient:
    """
    –ö–ª–∏–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ CometAPI LLM.
    
    –ú–µ—Ç–æ–¥—ã:
        analyze_messages: –ê–Ω–∞–ª–∏–∑ –±–∞—Ç—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        chunk_messages: –†–∞–∑–±–∏–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —á–∞–Ω–∫–∏
    """
    
    async def analyze_messages(
        self,
        messages: List[MessageData],
        chat_name: str
    ) -> AnalysisResult:
        """
        –ê–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π.
        
        –õ–æ–≥–∏–∫–∞:
        1. –†–∞–∑–±–∏–µ–Ω–∏–µ messages –Ω–∞ —á–∞–Ω–∫–∏ (chunk_messages)
        2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞:
           - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å JSON-—Å—Ö–µ–º–æ–π
           - POST –∑–∞–ø—Ä–æ—Å –∫ LLM API
           - –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Pydantic
        3. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤
        4. –í–æ–∑–≤—Ä–∞—Ç AnalysisResult
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            messages: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            chat_name: –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            AnalysisResult: –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã + –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        """
        
    def chunk_messages(
        self,
        messages: List[MessageData],
        max_tokens: int = 4000,
        max_messages: int = 50
    ) -> List[List[MessageData]]:
        """
        –†–∞–∑–±–∏–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–∞–∫–µ—Ç—ã.
        
        –õ–æ–≥–∏–∫–∞:
        1. –û—Ü–µ–Ω–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤: len(text) // 4 (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
        2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞–Ω–∫–æ–≤ —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–æ–≤
        3. –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ —á–∞–Ω–∫–æ–≤
        """
```

**API Endpoint**:
```http
POST https://api.cometapi.com/v1/chat/completions
Content-Type: application/json
Authorization: Bearer {COMET_API_KEY}

{
  "model": "gpt-4-turbo",
  "messages": [
    {
      "role": "system",
      "content": "–¢—ã - —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π..."
    },
    {
      "role": "user",
      "content": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:\n\n{messages_batch}"
    }
  ],
  "response_format": {"type": "json_object"},
  "temperature": 0.3
}
```

**–ü—Ä–æ–º–ø—Ç –¥–ª—è LLM**:
```text
SYSTEM PROMPT:
–¢—ã - —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram-—á–∞—Ç–æ–≤.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤—ã—è–≤–ª—è—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è.

–ö–ê–¢–ï–ì–û–†–ò–ò –ù–ê–†–£–®–ï–ù–ò–ô:
1. leak - —É—Ç–µ—á–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ø–∞—Ä–æ–ª–∏, API –∫–ª—é—á–∏, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ)
2. inappropriate - –Ω–µ–ø–æ–¥–æ–±–∞—é—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è, –¥–æ–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–∞, –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è)
3. spam - —Å–ø–∞–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. off_topic - –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–µ—Ä–∞–±–æ—á–∏—Ö —Ç–µ–º –≤ —Ä–∞–±–æ—á–µ–º —á–∞—Ç–µ
5. security_risk - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É–≥—Ä–æ–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ñ–∏—à–∏–Ω–≥, –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Å—Å—ã–ª–∫–∏)

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—Å—Ç—Ä–æ–≥–∏–π JSON):
{
  "incidents": [
    {
      "message_id": <int>,
      "category": "<leak|inappropriate|spam|off_topic|security_risk>",
      "severity": "<low|medium|high|critical>",
      "description": "<–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è>",
      "confidence": <float 0-1>
    }
  ],
  "summary": {
    "total_analyzed": <int>,
    "incidents_found": <int>,
    "risk_level": "<none|low|medium|high>"
  }
}

USER PROMPT:
–ß–∞—Ç: "{chat_name}"
–ü–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤

–°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
---
{formatted_messages}
---

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
```

**–§–æ—Ä–º–∞—Ç `formatted_messages`**:
```text
[ID: 12345] [2026-02-02 15:30] @username: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
[ID: 12346] [2026-02-02 15:32] @another_user: –î—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
[ID: 12347] [VOICE] [2026-02-02 15:35] @voice_user: [–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è] –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ
```

---

#### 2.2.3. –ö–ª–∞—Å—Å `ContentAnalyzer`

```python
# src/core/analyzer.py

class ContentAnalyzer:
    """
    –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç Whisper + LLM).
    
    –ê—Ç—Ä–∏–±—É—Ç—ã:
        whisper_client (WhisperClient): –ö–ª–∏–µ–Ω—Ç –¥–ª—è STT
        llm_client (LLMClient): –ö–ª–∏–µ–Ω—Ç –¥–ª—è LLM
        db (MessageRepository): –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    """
    
    async def process_chat(
        self,
        chat_id: int,
        messages: List[MessageData]
    ) -> ChatAnalysisResult:
        """
        –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞.
        
        –ê–õ–ì–û–†–ò–¢–ú:
        1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –≤ SQLite)
        2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö:
           for msg in messages:
               if msg.has_voice:
                   transcription = await whisper_client.transcribe_voice(msg.voice_path)
                   msg.text += f"\n[–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è] {transcription.text}"
        3. LLM –∞–Ω–∞–ª–∏–∑:
           analysis = await llm_client.analyze_messages(messages, chat_name)
        4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ SQLite
        5. –í–æ–∑–≤—Ä–∞—Ç ChatAnalysisResult
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            chat_id: ID —á–∞—Ç–∞
            messages: –°–æ–±—Ä–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Collector
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            ChatAnalysisResult: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        """
        
    async def aggregate_results(
        self,
        chat_results: List[ChatAnalysisResult]
    ) -> GlobalReport:
        """
        –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º.
        
        –õ–æ–≥–∏–∫–∞:
        1. –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        2. –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –ø–æ severity
        3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        4. –í–æ–∑–≤—Ä–∞—Ç GlobalReport
        """
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `WhisperClient`
- `LLMClient`
- `storage.database.MessageRepository`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `chat_id` –∏ `List[MessageData]` –∏–∑ Collector

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- `ChatAnalysisResult`: –°–ø–∏—Å–æ–∫ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ + –º–µ—Ç—Ä–∏–∫–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ SQLite

---

### 2.3. –ú–æ–¥—É–ª—å Manager (aiogram Bot)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 2.3.1. –ö–ª–∞—Å—Å `TelegramBot`

```python
# src/manager/bot.py

class TelegramBot:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
    
    –ú–µ—Ç–æ–¥—ã:
        start: –ó–∞–ø—É—Å–∫ long polling
        stop: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
    """
    
    def __init__(self, token: str, admin_id: int):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤.
        
        –õ–æ–≥–∏–∫–∞:
        1. –°–æ–∑–¥–∞–Ω–∏–µ Bot –∏ Dispatcher
        2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏–∑ handlers.py
        3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        
    async def start_polling(self):
        """–ó–∞–ø—É—Å–∫ long polling –≤ —Ñ–æ–Ω–µ"""
        
    async def stop_polling(self):
        """–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º pending tasks"""
```

---

#### 2.3.2. –ú–æ–¥—É–ª—å `handlers`

```python
# src/manager/handlers.py

router = Router()

@router.message(Command("start"))
async def cmd_start(message: Message):
    """
    –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø—Ä–∞–≤–∫–∞.
    
    –û—Ç–≤–µ—Ç:
    '''
    ü§ñ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–∞—Ç–æ–≤ v1.0
    
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
    /status - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
    /scan - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
    /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥
    /help - –°–ø—Ä–∞–≤–∫–∞
    '''
    """

@router.message(Command("status"))
async def cmd_status(message: Message, scheduler: APScheduler):
    """
    –û—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã.
    
    –õ–æ–≥–∏–∫–∞:
    1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Telethon (health_check)
    2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ APScheduler
    3. –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞—Ç–æ–≤ –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
    4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∞–º–∏
    
    –û—Ç–≤–µ—Ç:
    '''
    üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:
    ‚úÖ Userbot: –ê–∫—Ç–∏–≤–µ–Ω
    üïê –°–ª–µ–¥—É—é—â–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ 15 –º–∏–Ω—É—Ç
    üìÅ –ß–∞—Ç–æ–≤ –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ: 30
    
    [üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]
    '''
    """

@router.message(Command("scan"))
async def cmd_force_scan(message: Message):
    """
    –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
    
    –õ–æ–≥–∏–∫–∞:
    1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (—Ç–æ–ª—å–∫–æ admin_id)
    2. –ó–∞–ø—É—Å–∫ scan_all_chats() –≤ —Ñ–æ–Ω–µ
    3. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∞–ª–µ
    4. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """

@router.callback_query(F.data.startswith("incident_"))
async def handle_incident_action(callback: CallbackQuery):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—É.
    
    –§–æ—Ä–º–∞—Ç callback_data: "incident_{action}_{incident_id}"
    Actions: false_positive, confirm, add_to_whitelist
    
    –õ–æ–≥–∏–∫–∞:
    1. –ü–∞—Ä—Å–∏–Ω–≥ callback_data
    2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ –≤ SQLite
    3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∫–∏ ‚úÖ –∏–ª–∏ ‚ùå)
    4. –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥ Google Sheets
    """
```

**–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥**:
```python
COMMANDS = [
    BotCommand(command="start", description="–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"),
    BotCommand(command="status", description="–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã"),
    BotCommand(command="scan", description="–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å"),
    BotCommand(command="stats", description="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
    BotCommand(command="help", description="–°–ø—Ä–∞–≤–∫–∞"),
]
```

---

#### 2.3.3. –ö–ª–∞—Å—Å `Notifier`

```python
# src/manager/notifier.py

class IncidentNotifier:
    """
    –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
    
    –ú–µ—Ç–æ–¥—ã:
        send_incident_alert: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
        send_summary_report: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
    """
    
    async def send_incident_alert(
        self,
        admin_id: int,
        incident: Incident
    ):
        """
        –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–¥–Ω–æ–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ.
        
        –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
        '''
        üö® –ò–ù–¶–ò–î–ï–ù–¢ #{id}
        
        üìç –ß–∞—Ç: {chat_name}
        üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @{username}
        üïê –í—Ä–µ–º—è: {timestamp}
        
        üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_emoji} {category_name}
        ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: {severity}
        üéØ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {confidence}%
        
        üí¨ –¢–µ–∫—Å—Ç:
        {message_text}
        
        üìù –û–ø–∏—Å–∞–Ω–∏–µ:
        {description}
        '''
        
        –ö–Ω–æ–ø–∫–∏:
        [‚ùå –õ–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ] [‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å]
        [üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ] [üîá –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∞]
        """
        
    async def send_summary_report(
        self,
        admin_id: int,
        report: GlobalReport
    ):
        """
        –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
        
        –§–æ—Ä–º–∞—Ç:
        '''
        üìä –°–í–û–î–ù–´–ô –û–¢–ß–ï–¢
        –ü–µ—Ä–∏–æ–¥: {start_time} - {end_time}
        
        ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–∞—Ç–æ–≤: {total_chats}
        üì® –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {total_messages}
        üéô –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö: {total_voices}
        
        üö® –ù–∞–π–¥–µ–Ω–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤: {total_incidents}
           ‚Ä¢ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ: {critical_count}
           ‚Ä¢ –í—ã—Å–æ–∫–∏–µ: {high_count}
           ‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ: {medium_count}
        
        üë• –°–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:
           ‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ: {missing_count}
           ‚Ä¢ –õ–∏—à–Ω–∏–µ: {extra_count}
        
        [üìÑ –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á–µ—Ç –≤ Sheets] [üìä –î–µ—Ç–∞–ª–∏]
        '''
        """
```

**–≠–º–æ–¥–∑–∏-–º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π**:
```python
CATEGORY_EMOJIS = {
    "leak": "üîê",
    "inappropriate": "‚ö†Ô∏è",
    "spam": "üì¢",
    "off_topic": "üí¨",
    "security_risk": "üõ°"
}

SEVERITY_EMOJIS = {
    "critical": "üî¥",
    "high": "üü†",
    "medium": "üü°",
    "low": "üü¢"
}
```

---

### 2.4. –ú–æ–¥—É–ª—å Storage (SQLite + Google Sheets)

#### 2.4.1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite

```python
# src/storage/database.py

class DatabaseManager:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä SQLite –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.
    
    –ú–µ—Ç–æ–¥—ã:
        init_db: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
        insert_message: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        get_messages: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    """
    
    async def init_db(self):
        """
        –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î.
        
        SQL:
        - CREATE TABLE messages (...)
        - CREATE TABLE incidents (...)
        - CREATE TABLE participants (...)
        - CREATE TABLE scan_logs (...)
        - CREATE UNIQUE INDEX idx_message_unique ON messages(chat_id, message_id)
        """
```
- –¢–∞–±–ª–∏—Ü–∞ messages_buffer: –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ –∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Google Sheets —Å –ø–æ–ª—è–º–∏ is_synced –∏ priority.
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã messages_buffer –≤ SQLite:
    ‚ó¶ id: INTEGER PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç).
    ‚ó¶ chat_id, message_id: –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–≤—è–∑–∫–∞ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.
    ‚ó¶ content: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏).
    ‚ó¶ is_synced: –§–ª–∞–≥ (0/1), —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ —É—Å–ø–µ—à–Ω—É—é –∑–∞–ø–∏—Å—å –≤ Google Sheets.
    ‚ó¶ priority: –£—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏ (0 ‚Äî –ª–æ–≥, 1 ‚Äî –∏–Ω—Ü–∏–¥–µ–Ω—Ç).

- –¢–∞–±–ª–∏—Ü–∞ processed_ids:     
‚ó¶ –•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ chat_id –∏ message_id –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ ¬´–∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º¬ª (–∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)

**–°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü** (—Å–º. —Ä–∞–∑–¥–µ–ª 3.1)

---

#### 2.4.2. Google Sheets Integration

```python
# src/storage/sheets.py

class GoogleSheetsManager:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä Google Sheets –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –æ—Ç—á–µ—Ç–æ–≤.
    
    –ê—Ç—Ä–∏–±—É—Ç—ã:
        client (gspread_asyncio.AsyncioGspreadClient): –ö–ª–∏–µ–Ω—Ç Google Sheets
        spreadsheet_id (str): ID —Ç–∞–±–ª–∏—Ü—ã
    """
    
    async def get_whitelist(self) -> Dict[int, List[int]]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ whitelist –∏–∑ –ª–∏—Å—Ç–∞ '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è'.
        
        –õ–æ–≥–∏–∫–∞:
        1. –ß—Ç–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è'
        2. –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–æ–ª–±—Ü–æ–≤: chat_id | chat_name | allowed_users
        3. –†–∞–∑–±–æ—Ä allowed_users (comma-separated IDs)
        4. –í–æ–∑–≤—Ä–∞—Ç Dict[chat_id, List[user_ids]]
        
        –§–æ—Ä–º–∞—Ç –ª–∏—Å—Ç–∞ '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è':
        | chat_id      | chat_name        | allowed_users           |
        |--------------|------------------|-------------------------|
        | -1001234567  | Marketing Team   | 123456,789012,345678    |
        | -1009876543  | Dev Team         | 111222,333444,555666    |
        """
        
    async def append_incidents(
        self,
        incidents: List[Incident]
    ):
        """
        –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ –ª–∏—Å—Ç '–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã'.
        
        –õ–æ–≥–∏–∫–∞:
        1. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ incidents –≤ —Å—Ç—Ä–æ–∫–∏
        2. –í—ã–∑–æ–≤ worksheet.append_rows(formatted_rows)
        3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ severity (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        
        –§–æ—Ä–º–∞—Ç –ª–∏—Å—Ç–∞ '–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã':
        | timestamp            | chat_name | username | category | severity | description | status |
        |----------------------|-----------|----------|----------|----------|-------------|--------|
        | 2026-02-02 15:30:00 | Marketing | @user1   | leak     | high     | –£—Ç–µ—á–∫–∞ API  | new    |
        """
        
    async def append_participant_report(
        self,
        report: ParticipantReport
    ):
        """
        –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
        
        –§–æ—Ä–º–∞—Ç –ª–∏—Å—Ç–∞ '–£—á–∞—Å—Ç–Ω–∏–∫–∏':
        | scan_date           | chat_name | status  | user_id | username |
        |---------------------|-----------|---------|---------|----------|
        | 2026-02-02 18:00:00| Dev Team  | missing | 123456  | @john    |
        | 2026-02-02 18:00:00| Dev Team  | extra   | 999999  | @unknown |
        """
        
    async def append_scan_log(
        self,
        log: ScanLog
    ):
        """
        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
        
        –§–æ—Ä–º–∞—Ç –ª–∏—Å—Ç–∞ '–õ–æ–≥–∏':
        | timestamp            | chats_scanned | messages_processed | incidents_found | duration_sec |
        |----------------------|---------------|--------------------|--------------------|-------------|
        | 2026-02-02 18:00:00 | 30            | 1543               | 7                  | 42.5        |
        """
```
#### 2.4.3. –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –æ—á–∏—Å—Ç–∫–∏
–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞:
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ: –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets —á–µ—Ä–µ–∑ gspread_asyncio, –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª—è content –≤ —Ç–∞–±–ª–∏—Ü–µ messages_buffer —É–¥–∞–ª—è–µ—Ç—Å—è.
2. –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏: –¢–∞–±–ª–∏—Ü–∞ processed_ids –æ—á–∏—â–∞–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º APScheduler —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞.
–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (Transactional Outbox):
‚Ä¢ –£—Ä–æ–≤–µ–Ω—å ¬´–ò–Ω—Ü–∏–¥–µ–Ω—Ç¬ª (–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ):
    ‚ó¶ –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–Ω–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º, –æ–Ω–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è priority=1.
    ‚ó¶ –°–∏—Å—Ç–µ–º–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç notifier.py –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–¥–º–∏–Ω—É —á–µ—Ä–µ–∑ Bot (Manager).
    ‚ó¶ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ª–∏—Å—Ç–æ–º ¬´–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ¬ª –≤ Google Sheets –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É, –æ–±—Ö–æ–¥—è –æ–±—â—É—é –æ—á–µ—Ä–µ–¥—å –ª–æ–≥–æ–≤.
‚Ä¢ –£—Ä–æ–≤–µ–Ω—å ¬´–õ–æ–≥–∏ –∏ –£—á–∞—Å—Ç–Ω–∏–∫–∏¬ª (–ü–∞–∫–µ—Ç–Ω–æ):
    ‚ó¶ –î–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ SQLite –≤ —Ç–µ—á–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
    ‚ó¶ –†–∞–∑ –≤ —á–∞—Å –∏–ª–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö 30 —á–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è Bulk Update —á–µ—Ä–µ–∑ gspread_asyncio –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ª–∏–º–∏—Ç–æ–≤ Google API

#### 2.4.4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (Resilience)
–î–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏: –ï—Å–ª–∏ Google API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ñ–ª–∞–≥ is_synced –æ—Å—Ç–∞–µ—Ç—Å—è —Ä–∞–≤–Ω—ã–º 0. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ data/local_db.sqlite.
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (—á–µ—Ä–µ–∑ 6 —á–∞—Å–æ–≤) —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π —Å is_synced=0 –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ Google Sheets.
‚Ä¢ –û–±—Ö–æ–¥ –ª–∏–º–∏—Ç–æ–≤: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö —á–µ—Ä–µ–∑ aiogram –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∞–¥–º–∏–Ω—É, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ Google Sheets API –ø–æ –ª–∏–º–∏—Ç–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤.
   
---

### 2.5. –ú–æ–¥—É–ª—å Scheduler

```python
# src/scheduler/jobs.py

class ScanJob:
    """
    –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤.
    
    –ú–µ—Ç–æ–¥—ã:
        run: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    """
    
    async def run(self):
        """
        –ü–û–õ–ù–´–ô –¶–ò–ö–õ –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø
        
        –ê–õ–ì–û–†–ò–¢–ú:
        1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
           - collector = TelethonCollector()
           - analyzer = ContentAnalyzer()
           - notifier = IncidentNotifier()
           
        2. –ü–æ–ª—É—á–µ–Ω–∏–µ whitelist –∏–∑ Google Sheets
        
        3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ chat_id –≤ whitelist:
           a) –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:
              - messages = await collector.collect_messages(chat_id, hours_back=6)
              - participants = await collector.get_full_participants(chat_id)
           
           b) –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞:
              - await asyncio.sleep(random.randint(10, 30))
           
           c) –ê–Ω–∞–ª–∏–∑:
              - chat_result = await analyzer.process_chat(chat_id, messages)
              - participant_report = await collector.compare_with_whitelist(
                  chat_id, participants, whitelist[chat_id]
                )
           
           d) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:
              - await sheets.append_incidents(chat_result.incidents)
              - await sheets.append_participant_report(participant_report)
           
           e) –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã):
              for incident in chat_result.incidents:
                  if incident.severity in ["high", "critical"]:
                      await notifier.send_incident_alert(admin_id, incident)
        
        4. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
           - global_report = analyzer.aggregate_results(all_chat_results)
           - await notifier.send_summary_report(admin_id, global_report)
           - await sheets.append_scan_log(global_report.to_scan_log())
        
        5. –û—á–∏—Å—Ç–∫–∞:
           - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ data/temp/
        """
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞**:
```python
# main.py

scheduler = AsyncIOScheduler()

# –û—Å–Ω–æ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
scheduler.add_job(
    ScanJob().run,
    trigger='interval',
    hours=6,
    id='main_scan',
    replace_existing=True,
    max_instances=1  # –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–ª–æ–∂–µ–Ω–∏—è
)

# Health check - –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
scheduler.add_job(
    health_check_job,
    trigger='interval',
    minutes=15,
    id='health_check'
)

scheduler.start()
```

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### 3.1. –°—Ö–µ–º–∞ SQLite

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)
CREATE TABLE IF NOT EXISTS messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chat_id BIGINT NOT NULL,
    message_id BIGINT NOT NULL,
    sender_id BIGINT,
    sender_username TEXT,
    text TEXT,
    has_voice BOOLEAN DEFAULT 0,
    voice_transcription TEXT,
    timestamp DATETIME NOT NULL,
    collected_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(chat_id, message_id)
);

CREATE INDEX idx_message_timestamp ON messages(chat_id, timestamp);
CREATE INDEX idx_message_collected ON messages(collected_at);

-- –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
CREATE TABLE IF NOT EXISTS incidents (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    message_id BIGINT,
    chat_id BIGINT NOT NULL,
    chat_name TEXT,
    sender_id BIGINT,
    sender_username TEXT,
    category TEXT NOT NULL, -- leak, inappropriate, spam, off_topic, security_risk
    severity TEXT NOT NULL, -- low, medium, high, critical
    description TEXT,
    confidence REAL,
    status TEXT DEFAULT 'new', -- new, confirmed, false_positive, ignored
    detected_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    resolved_at DATETIME,
    resolved_by BIGINT,
    FOREIGN KEY (chat_id, message_id) REFERENCES messages(chat_id, message_id)
);

CREATE INDEX idx_incident_status ON incidents(status, severity);
CREATE INDEX idx_incident_chat ON incidents(chat_id, detected_at);

-- –¢–∞–±–ª–∏—Ü–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—Å–Ω–∞–ø—à–æ—Ç)
CREATE TABLE IF NOT EXISTS participants (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chat_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    is_bot BOOLEAN DEFAULT 0,
    snapshot_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(chat_id, user_id, snapshot_date)
);

CREATE INDEX idx_participant_chat ON participants(chat_id, snapshot_date);

-- –¢–∞–±–ª–∏—Ü–∞ –ª–æ–≥–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
CREATE TABLE IF NOT EXISTS scan_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    start_time DATETIME NOT NULL,
    end_time DATETIME,
    chats_scanned INTEGER DEFAULT 0,
    messages_processed INTEGER DEFAULT 0,
    voices_transcribed INTEGER DEFAULT 0,
    incidents_found INTEGER DEFAULT 0,
    status TEXT DEFAULT 'running', -- running, completed, failed
    error_message TEXT,
    duration_seconds REAL
);

CREATE INDEX idx_scan_date ON scan_logs(start_time);
```

---

### 3.2. Pydantic –º–æ–¥–µ–ª–∏

```python
# src/models/data.py

from pydantic import BaseModel, Field
from datetime import datetime
from typing import Optional, List
from enum import Enum

# ===== ENUMS =====

class IncidentCategory(str, Enum):
    LEAK = "leak"
    INAPPROPRIATE = "inappropriate"
    SPAM = "spam"
    OFF_TOPIC = "off_topic"
    SECURITY_RISK = "security_risk"

class Severity(str, Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

class IncidentStatus(str, Enum):
    NEW = "new"
    CONFIRMED = "confirmed"
    FALSE_POSITIVE = "false_positive"
    IGNORED = "ignored"

# ===== DATA MODELS =====

class MessageData(BaseModel):
    """–ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram"""
    chat_id: int
    message_id: int
    sender_id: Optional[int]
    sender_username: Optional[str]
    text: Optional[str]
    has_voice: bool = False
    voice_path: Optional[str] = None
    voice_transcription: Optional[str] = None
    timestamp: datetime
    
    class Config:
        json_schema_extra = {
            "example": {
                "chat_id": -1001234567890,
                "message_id": 12345,
                "sender_id": 123456789,
                "sender_username": "john_doe",
                "text": "–ü—Ä–∏–≤–µ—Ç, –∫–æ–ª–ª–µ–≥–∏!",
                "has_voice": False,
                "timestamp": "2026-02-02T15:30:00"
            }
        }

class TranscriptionResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ"""
    text: str
    language: str = "ru"
    duration: float
    confidence: Optional[float] = None

class Incident(BaseModel):
    """–ú–æ–¥–µ–ª—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    id: Optional[int] = None
    message_id: int
    chat_id: int
    chat_name: str
    sender_id: Optional[int]
    sender_username: Optional[str]
    category: IncidentCategory
    severity: Severity
    description: str
    confidence: float = Field(ge=0.0, le=1.0)
    status: IncidentStatus = IncidentStatus.NEW
    detected_at: datetime = Field(default_factory=datetime.now)
    
    def to_dict(self) -> dict:
        """–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Google Sheets"""
        return {
            "timestamp": self.detected_at.isoformat(),
            "chat_name": self.chat_name,
            "username": self.sender_username or "Unknown",
            "category": self.category.value,
            "severity": self.severity.value,
            "description": self.description,
            "confidence": f"{self.confidence:.2%}",
            "status": self.status.value
        }

class ParticipantData(BaseModel):
    """–ú–æ–¥–µ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–∞—Ç–∞"""
    user_id: int
    username: Optional[str]
    first_name: Optional[str]
    last_name: Optional[str]
    is_bot: bool = False

class ParticipantReport(BaseModel):
    """–û—Ç—á–µ—Ç –æ —Å–≤–µ—Ä–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"""
    chat_id: int
    chat_name: str
    missing: List[ParticipantData] = []  # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å, –Ω–æ –∏—Ö –Ω–µ—Ç
    extra: List[ParticipantData] = []    # –ï—Å—Ç—å, –Ω–æ –Ω–µ –≤ whitelist
    timestamp: datetime = Field(default_factory=datetime.now)

class ChatAnalysisResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞"""
    chat_id: int
    chat_name: str
    messages_analyzed: int
    voices_transcribed: int
    incidents: List[Incident]
    processing_time: float
    
class GlobalReport(BaseModel):
    """–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º"""
    scan_id: int
    start_time: datetime
    end_time: datetime
    chats_scanned: int
    total_messages: int
    total_voices: int
    total_incidents: int
    critical_incidents: int
    high_incidents: int
    medium_incidents: int
    low_incidents: int
    missing_participants: int
    extra_participants: int
    duration_seconds: float
    
    def to_scan_log(self) -> dict:
        """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è scan_logs —Ç–∞–±–ª–∏—Ü—ã"""
        return {
            "start_time": self.start_time,
            "end_time": self.end_time,
            "chats_scanned": self.chats_scanned,
            "messages_processed": self.total_messages,
            "voices_transcribed": self.total_voices,
            "incidents_found": self.total_incidents,
            "status": "completed",
            "duration_seconds": self.duration_seconds
        }
```

---

### 3.3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Settings)

```python
# config/settings.py

from pydantic_settings import BaseSettings, SettingsConfigDict
from pathlib import Path

class TelethonSettings(BaseSettings):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telethon Userbot"""
    api_id: int
    api_hash: str
    phone: str
    session_path: Path = Path("data/sessions/userbot.session")
    
    model_config = SettingsConfigDict(env_prefix="TG_")

class AiogramSettings(BaseSettings):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ aiogram Bot"""
    bot_token: str
    admin_id: int
    
    model_config = SettingsConfigDict(env_prefix="BOT_")

class CometAPISettings(BaseSettings):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ CometAPI"""
    api_key: str
    api_url: str = "https://api.comet.com/v1"
    whisper_model: str = "whisper-1"
    llm_model: str = "gpt-4-turbo"
    
    model_config = SettingsConfigDict(env_prefix="COMET_")

class GoogleSheetsSettings(BaseSettings):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets"""
    spreadsheet_id: str
    service_account_path: Path = Path("config/service_account.json")
    
    model_config = SettingsConfigDict(env_prefix="GOOGLE_")

class AppSettings(BaseSettings):
    """–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    scan_interval_hours: int = 6
    max_messages_per_chunk: int = 50
    max_chunk_tokens: int = 4000
    voice_download_timeout: int = 30
    voice_max_size_mb: int = 50
    flood_delay_min: int = 10
    flood_delay_max: int = 30
    
    model_config = SettingsConfigDict(env_prefix="APP_")

class Settings:
    """–û–±—â–∏–π –∫–ª–∞—Å—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
    telethon: TelethonSettings
    aiogram: AiogramSettings
    comet_api: CometAPISettings
    google_sheets: GoogleSheetsSettings
    app: AppSettings
    
    def __init__(self):
        self.telethon = TelethonSettings()
        self.aiogram = AiogramSettings()
        self.comet_api = CometAPISettings()
        self.google_sheets = GoogleSheetsSettings()
        self.app = AppSettings()

# Singleton
settings = Settings()
```

---

### 3.4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google Sheets

**–õ–∏—Å—Ç: "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"**

| chat_id       | chat_name        | allowed_users               | monitoring_enabled |
|---------------|------------------|-----------------------------|-------------------|
| -1001234567   | Marketing Team   | 123456,789012,345678        | TRUE              |
| -1009876543   | Dev Team         | 111222,333444,555666        | TRUE              |
| -1005555555   | HR Chat          | 777888,999000               | FALSE             |

**–õ–∏—Å—Ç: "–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã"**

| timestamp            | chat_name    | username  | category        | severity | description           | confidence | status    |
|----------------------|--------------|-----------|-----------------|----------|-----------------------|-----------|-----------|
| 2026-02-02 15:30:00 | Marketing    | @user1    | leak            | high     | –£—Ç–µ—á–∫–∞ API –∫–ª—é—á–∞      | 95%       | new       |
| 2026-02-02 16:15:00 | Dev Team     | @dev2     | inappropriate   | medium   | –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–≥–∏   | 78%       | confirmed |

**–õ–∏—Å—Ç: "–£—á–∞—Å—Ç–Ω–∏–∫–∏"**

| scan_date            | chat_name    | status  | user_id  | username  | first_name | last_name |
|----------------------|--------------|---------|----------|-----------|-----------|-----------|
| 2026-02-02 18:00:00 | Marketing    | missing | 123456   | @john     | John      | Doe       |
| 2026-02-02 18:00:00 | Dev Team     | extra   | 999999   | @unknown  | Unknown   | User      |

**–õ–∏—Å—Ç: "–õ–æ–≥–∏"**

| timestamp            | chats_scanned | messages_processed | voices_transcribed | incidents_found | duration_sec | status    |
|----------------------|---------------|--------------------|--------------------|-----------------|-------------|-----------|
| 2026-02-02 18:00:00 | 30            | 1543               | 47                 | 7               | 42.5        | completed |
| 2026-02-02 12:00:00 | 30            | 1289               | 38                 | 3               | 38.2        | completed |

---

## 4. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 4.1. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇScheduler‚îÇ      ‚îÇCollector‚îÇ      ‚îÇAnalyzer ‚îÇ      ‚îÇManager ‚îÇ      ‚îÇStorage ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                ‚îÇ                 ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ Trigger(6h)    ‚îÇ                 ‚îÇ                ‚îÇ                ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>                 ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ                ‚îÇ                 ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ Get Whitelist   ‚îÇ       ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ from Sheets     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ                ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
    ‚îÇ                ‚îÇ                 ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        for each chat:            ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ iter_messages(6h)       ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ        ‚îÇ get_participants()      ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ sleep(random 10-30s)    ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ MessageData[]           ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îÇ For voice msgs: ‚îÇ       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îÇ Whisper STT     ‚îÇ       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îÇ Chunk messages  ‚îÇ       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îÇ Send to LLM     ‚îÇ       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                ChatAnalysisResult        ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ Save to SQLite & Sheets ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ if incidents.severity >= high:          ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ     ‚îÇ send_incident_alert‚îÇ     ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ     ‚îÇ to admin           ‚îÇ     ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        end for each chat         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ GlobalReport            ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ send_summary_report            ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îÇ Save scan log           ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
    ‚îÇ        ‚îÇ                         ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ  End cycle                       ‚îÇ                ‚îÇ                ‚îÇ
    ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                         ‚îÇ                ‚îÇ                ‚îÇ
```

### 4.2. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –°–±–æ—Ä—â–∏–∫**
```python
# Google Sheets (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è) ‚Üí Collector
whitelist = await sheets_manager.get_whitelist()
# whitelist = {
#     -1001234567: [123456, 789012, 345678],
#     -1009876543: [111222, 333444, 555666]
# }

for chat_id, allowed_users in whitelist.items():
    if not await sheets_manager.is_monitoring_enabled(chat_id):
        continue
    # –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö...
```

**2. –°–±–æ—Ä—â–∏–∫ ‚Üí –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä**
```python
# Collector ‚Üí Analyzer
messages = await collector.collect_messages(chat_id, hours_back=6)
participants = await collector.get_full_participants(chat_id)

# messages: List[MessageData]
# participants: List[ParticipantData]

chat_result = await analyzer.process_chat(chat_id, messages)
participant_report = await collector.compare_with_whitelist(
    chat_id, participants, whitelist[chat_id]
)
```

**3. –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Üí –•—Ä–∞–Ω–∏–ª–∏—â–µ**
```python
# Analyzer ‚Üí Storage
await db.insert_incidents(chat_result.incidents)
await sheets.append_incidents(chat_result.incidents)
await sheets.append_participant_report(participant_report)
```

**4. –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Üí –ú–µ–Ω–µ–¥–∂–µ—Ä**
```python
# Analyzer ‚Üí Manager (—á–µ—Ä–µ–∑ Notifier)
for incident in chat_result.incidents:
    if incident.severity in [Severity.HIGH, Severity.CRITICAL]:
        await notifier.send_incident_alert(admin_id, incident)

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞
global_report = analyzer.aggregate_results(all_chat_results)
await notifier.send_summary_report(admin_id, global_report)
```

### 4.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**FloodWait (Telethon)**
```python
from telethon.errors import FloodWaitError
import asyncio

async def safe_collect_messages(chat_id: int):
    try:
        messages = await collector.collect_messages(chat_id)
    except FloodWaitError as e:
        logger.warning(f"FloodWait {e.seconds}s for chat {chat_id}")
        await asyncio.sleep(e.seconds + 10)  # +10 –¥–ª—è –∑–∞–ø–∞—Å–∞
        messages = await collector.collect_messages(chat_id)  # –ü–æ–≤—Ç–æ—Ä
    return messages
```

**API Timeout (CometAPI)**
```python
async def safe_api_call(func, *args, max_retries=3, **kwargs):
    for attempt in range(max_retries):
        try:
            return await asyncio.wait_for(func(*args, **kwargs), timeout=60)
        except asyncio.TimeoutError:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(2 ** attempt)  # Exponential backoff
```

**Google Sheets Rate Limit**
```python
from gspread.exceptions import APIError

async def safe_sheets_write(func, *args, **kwargs):
    try:
        return await func(*args, **kwargs)
    except APIError as e:
        if "RATE_LIMIT_EXCEEDED" in str(e):
            # Fallback: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ SQLite
            logger.error("Sheets rate limit, using SQLite only")
            return None
        raise
```

---

## 5. –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠–¢–ê–ü 1: MVP (–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç)

**–¶–µ–ª—å**: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—É –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ - —Å–±–æ—Ä, –∞–Ω–∞–ª–∏–∑, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–°—Ä–æ–∫–∏**: 10-14 –¥–Ω–µ–π  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

#### –ó–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 1:

| ‚Ññ | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|---|--------|----------|--------|-------------|
| 1.1 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ | –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫, requirements.txt, .env | 2—á | - |
| 1.2 | SQLite —Å—Ö–µ–º–∞ –∏ –±–∞–∑–∞ | –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü messages, incidents, scan_logs | 3—á | 1.1 |
| 1.3 | Pydantic –º–æ–¥–µ–ª–∏ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö data models –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3.2 | 4—á | 1.1 |
| 1.4 | Settings & Configuration | Pydantic-settings –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ | 3—á | 1.1, 1.3 |
| 1.5 | Logger setup | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Loguru —Å —Ä–æ—Ç–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤ | 2—á | 1.1 |
| **1.6** | **Telethon Client** | **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è userbot, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** | **6—á** | **1.4, 1.5** |
| **1.7** | **MessageHistoryCollector** | **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è collect_messages (–ë–ï–ó –≥–æ–ª–æ—Å–æ–≤—ã—Ö)** | **8—á** | **1.2, 1.3, 1.6** |
| **1.8** | **ParticipantCollector** | **get_full_participants + compare_with_whitelist** | **6—á** | **1.3, 1.6** |
| 1.9 | Google Sheets –±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –ß—Ç–µ–Ω–∏–µ whitelist –∏–∑ –ª–∏—Å—Ç–∞ "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è" | 5—á | 1.4 |
| **1.10** | **LLMClient (–±–∞–∑–æ–≤—ã–π)** | **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –ë–ï–ó —á–∞–Ω–∫–∏–Ω–≥–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç)** | **8—á** | **1.3, 1.4** |
| **1.11** | **ContentAnalyzer (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)** | **–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Ç–∞ –ë–ï–ó –≥–æ–ª–æ—Å–æ–≤—ã—Ö** | **6—á** | **1.7, 1.10** |
| 1.12 | Sheets –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | append_incidents + append_participant_report | 4—á | 1.9 |
| **1.13** | **aiogram Bot –±–∞–∑–æ–≤—ã–π** | **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∫–æ–º–∞–Ω–¥—ã /start, /status** | **5—á** | **1.4, 1.5** |
| **1.14** | **Notifier (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)** | **send_incident_alert –ë–ï–ó –∫–Ω–æ–ø–æ–∫** | **4—á** | **1.3, 1.13** |
| **1.15** | **ScanJob (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª)** | **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è: Collector ‚Üí Analyzer ‚Üí Notifier** | **10—á** | **1.7-1.14** |
| 1.16 | Scheduler –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | APScheduler —Å –∑–∞–ø—É—Å–∫–æ–º –∫–∞–∂–¥—ã–µ 6—á | 3—á | 1.15 |
| 1.17 | main.py —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ | –ó–∞–ø—É—Å–∫ Scheduler + Bot polling –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ | 3—á | 1.13, 1.16 |
| **1.18** | **–ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MVP** | **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 3-5 —á–∞—Ç–∞—Ö** | **6—á** | **1.17** |
| 1.19 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ | FloodWait, API timeout, Sheets fallback | 5—á | 1.15 |
| 1.20 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è MVP | README, .env.example, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É | 3—á | 1.18 |

**–ò—Ç–æ–≥–æ –≠—Ç–∞–ø 1**: ~96 —á–∞—Å–æ–≤ (~12 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –ø—Ä–∏ 8—á/–¥–µ–Ω—å)

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ MVP:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ 6 —á–∞—Å–æ–≤ –∏–∑ 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- ‚úÖ LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏ –Ω–∞—Ö–æ–¥–∏—Ç —Ö–æ—Ç—è –±—ã 1 —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Google Sheets
- ‚úÖ –°–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

---

### –≠–¢–ê–ü 2: –î–æ—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¶–µ–ª—å**: –î–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º

**–°—Ä–æ–∫–∏**: 8-12 –¥–Ω–µ–π  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í–´–°–û–ö–ò–ô

#### –ó–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 2:

| ‚Ññ | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|---|--------|----------|--------|-------------|
| 2.1 | Whisper –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | WhisperClient + download_voice —Å —Ç–∞–π–º–∞—É—Ç–æ–º | 6—á | –≠—Ç–∞–ø 1 |
| 2.2 | –ì–æ–ª–æ—Å–æ–≤—ã–µ –≤ Analyzer | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Whisper –≤ ContentAnalyzer.process_chat | 4—á | 2.1 |
| 2.3 | LLM —á–∞–Ω–∫–∏–Ω–≥ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è chunk_messages + –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ | 5—á | –≠—Ç–∞–ø 1 |
| 2.4 | –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ LLM | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤, —Ç–æ—á–Ω–∞—è JSON-—Å—Ö–µ–º–∞ | 4—á | –≠—Ç–∞–ø 1 |
| 2.5 | Inline –∫–Ω–æ–ø–∫–∏ –≤ –∞–ª–µ—Ä—Ç–∞—Ö | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ [–õ–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ] / [–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] | 5—á | –≠—Ç–∞–ø 1 |
| 2.6 | Callback handlers | –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ | 6—á | 2.5 |
| 2.7 | –ö–æ–º–∞–Ω–¥–∞ /scan | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è | 4—á | –≠—Ç–∞–ø 1 |
| 2.8 | –ö–æ–º–∞–Ω–¥–∞ /stats | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ | 5—á | –≠—Ç–∞–ø 1 |
| 2.9 | –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç | send_summary_report —Å –∫–Ω–æ–ø–∫–∞–º–∏ | 4—á | –≠—Ç–∞–ø 1 |
| 2.10 | Health check job | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ userbot –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω | 3—á | –≠—Ç–∞–ø 1 |
| 2.11 | –£–ª—É—á—à–µ–Ω–Ω–∞—è anti-flood –∑–∞—â–∏—Ç–∞ | –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ FloodWait | 5—á | –≠—Ç–∞–ø 1 |
| 2.12 | Retry –º–µ—Ö–∞–Ω–∏–∑–º | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤ | 4—á | –≠—Ç–∞–ø 1 |
| 2.13 | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | Structured logs, metrics –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ | 4—á | –≠—Ç–∞–ø 1 |
| 2.14 | –¢–∞–±–ª–∏—Ü–∞ participants –≤ SQLite | –°–Ω–∞–ø—à–æ—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ | 3—á | –≠—Ç–∞–ø 1 |
| 2.15 | –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ | 2—á | 2.1 |
| 2.16 | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î | –ò–Ω–¥–µ–∫—Å—ã, VACUUM, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π | 4—á | –≠—Ç–∞–ø 1 |
| 2.17 | –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 30 —á–∞—Ç–æ–≤ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ | 8—á | 2.1-2.16 |
| 2.18 | –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases | –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | 6—á | –≠—Ç–∞–ø 1 |
| 2.19 | –£–ª—É—á—à–µ–Ω–∏–µ UI —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | –≠–º–æ–¥–∑–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, preview —Å—Å—ã–ª–æ–∫ | 3—á | 2.9 |
| 2.20 | –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü–æ–ª–Ω—ã–π E2E —Ç–µ—Å—Ç –Ω–∞ 30 —á–∞—Ç–∞—Ö, 24—á —Ä–∞–±–æ—Ç—ã | 10—á | 2.17 |
| 2.21 | Production –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | –î–µ–ø–ª–æ–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, troubleshooting | 4—á | 2.20 |

**–ò—Ç–æ–≥–æ –≠—Ç–∞–ø 2**: ~89 —á–∞—Å–æ–≤ (~11 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ –≠—Ç–∞–ø 2:
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (>90% —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 30 —á–∞—Ç–∞–º–∏ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç, —Å—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- ‚úÖ –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã, –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ 24 —á–∞—Å–∞ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

### –≠–¢–ê–ü 3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–¶–µ–ª—å**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ù–ò–ó–ö–ò–ô

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏:
- 3.1. Dashboard –Ω–∞ Streamlit –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ (16—á)
- 3.2. Machine Learning –º–æ–¥–µ–ª—å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ (–≤–º–µ—Å—Ç–æ LLM) (40—á)
- 3.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º SIEM (Splunk, ELK) (20—á)
- 3.4. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π + —Ä—É—Å—Å–∫–∏–π) (12—á)
- 3.5. Telegram Mini App –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π (32—á)
- 3.6. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ LLM (8—á)
- 3.7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–∫–∏–∫ –ª–∏—à–Ω–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) - –í–´–°–û–ö–ò–ô –†–ò–°–ö (16—á)

---

## 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 6.1. –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≠—Ç–∞–ø–∞ 1 (MVP)

#### –ú–æ–¥—É–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**1. TelethonCollector**
```python
# tests/test_collector.py

import pytest
from src.collector.client import TelethonCollector

@pytest.mark.asyncio
async def test_session_initialization():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    collector = TelethonCollector(api_id, api_hash, phone)
    await collector.start_session()
    assert collector.client.is_connected()
    await collector.stop_session()

@pytest.mark.asyncio
async def test_health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞"""
    collector = TelethonCollector(api_id, api_hash, phone)
    await collector.start_session()
    is_healthy = await collector.health_check()
    assert is_healthy is True
    await collector.stop_session()
```

**2. MessageHistoryCollector**
```python
@pytest.mark.asyncio
async def test_collect_messages_returns_data():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥"""
    collector = MessageHistoryCollector(client)
    messages = await collector.collect_messages(
        chat_id=-1001234567,
        hours_back=6
    )
    assert len(messages) > 0
    assert all(isinstance(m, MessageData) for m in messages)

@pytest.mark.asyncio
async def test_deduplicate_messages():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏"""
    # –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–≤–∞–∂–¥—ã
    messages1 = await collector.collect_messages(chat_id, hours_back=1)
    messages2 = await collector.collect_messages(chat_id, hours_back=1)
    
    # –í –ë–î –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    count = await db.count_messages(chat_id)
    assert count == len(messages1)
```

**3. LLMClient**
```python
@pytest.mark.asyncio
async def test_llm_analysis_returns_incidents():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ LLM –∞–Ω–∞–ª–∏–∑–∞"""
    llm_client = LLMClient(api_key, api_url)
    test_messages = [
        MessageData(
            chat_id=-1001234567,
            message_id=1,
            text="–ù–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π API –∫–ª—é—á: sk-abc123...",
            timestamp=datetime.now()
        )
    ]
    
    result = await llm_client.analyze_messages(test_messages, "Test Chat")
    assert result.summary["incidents_found"] > 0
    assert any(i.category == IncidentCategory.LEAK for i in result.incidents)
```

**4. ParticipantCollector**
```python
@pytest.mark.asyncio
async def test_participant_comparison():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"""
    participants = [
        ParticipantData(user_id=123, username="user1"),
        ParticipantData(user_id=456, username="user2"),
        ParticipantData(user_id=999, username="intruder")  # –õ–∏—à–Ω–∏–π
    ]
    whitelist = [123, 456, 789]  # 789 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
    
    report = await collector.compare_with_whitelist(
        chat_id=-1001234567,
        participants=participants,
        whitelist=whitelist
    )
    
    assert len(report.missing) == 1
    assert report.missing[0].user_id == 789
    assert len(report.extra) == 1
    assert report.extra[0].user_id == 999
```

---

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞**
```python
@pytest.mark.asyncio
@pytest.mark.integration
async def test_full_scan_cycle_single_chat():
    """
    GIVEN: –¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç —Å 10 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ 5 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
    WHEN: –ó–∞–ø—É—Å–∫ ScanJob.run() –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞
    THEN:
      - –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ–±—Ä–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ SQLite
      - LLM –∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
      - –ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets
      - –õ–æ–≥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω
    """
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    test_chat_id = -1001234567
    
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    await scan_job.run_single_chat(test_chat_id)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    messages_in_db = await db.get_messages(test_chat_id)
    assert len(messages_in_db) == 10
    
    incidents_in_db = await db.get_incidents(test_chat_id)
    # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø—Ä–æ—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
    assert incidents_in_db is not None
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ Sheets
    sheets_data = await sheets.get_incidents()
    assert any(row["chat_id"] == test_chat_id for row in sheets_data)
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ FloodWait**
```python
@pytest.mark.asyncio
@pytest.mark.integration
async def test_flood_wait_handling():
    """
    GIVEN: –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å FloodWait –æ—Ç Telegram
    WHEN: –ü–æ–ø—ã—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Ç–æ–≤
    THEN: –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∂–¥–µ—Ç –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
    """
    # –ò–º–∏—Ç–∞—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫)
    chat_ids = [-1001234567, -1009876543, -1005555555]
    
    results = []
    for chat_id in chat_ids:
        try:
            messages = await collector.collect_messages(chat_id)
            results.append({"chat_id": chat_id, "status": "success"})
        except Exception as e:
            results.append({"chat_id": chat_id, "status": "error", "error": str(e)})
    
    # –í—Å–µ —á–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–≤–æ–∑–º–æ–∂–Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
    assert all(r["status"] == "success" for r in results)
```

---

#### E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç-–∫–µ–π—Å 1: –£—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
```gherkin
Feature: –î–µ—Ç–µ–∫—Ü–∏—è —É—Ç–µ—á–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

Scenario: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—É–±–ª–∏–∫—É–µ—Ç API –∫–ª—é—á –≤ —á–∞—Ç–µ
  Given –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —á–∞—Ç "Test Chat"
  And –í —á–∞—Ç–µ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º "–ù–∞—à —Ç–æ–∫–µ–Ω: sk-abc123xyz"
  When –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  Then LLM –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "leak" —Å severity "high"
  And –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∞–ª–µ—Ä—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
  And –ò–Ω—Ü–∏–¥–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Google Sheets
```

**–¢–µ—Å—Ç-–∫–µ–π—Å 2: –õ–∏—à–Ω–∏–π —É—á–∞—Å—Ç–Ω–∏–∫**
```gherkin
Feature: –°–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ —Å whitelist

Scenario: –í —á–∞—Ç–µ –ø–æ—è–≤–∏–ª—Å—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  Given Whitelist –¥–ª—è —á–∞—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç [123, 456, 789]
  And –í —á–∞—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ [123, 456, 999]
  When –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  Then –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ª–∏—à–Ω–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ 999
  And –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ª–∏—à–Ω–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–µ
  And –û—Ç—á–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∏—Å—Ç "–£—á–∞—Å—Ç–Ω–∏–∫–∏"
```

**–¢–µ—Å—Ç-–∫–µ–π—Å 3: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º**
```gherkin
Feature: –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

Scenario: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å –Ω–µ–ø–æ–¥–æ–±–∞—é—â–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
  Given –í —á–∞—Ç–µ –µ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 15 —Å–µ–∫—É–Ω–¥
  And –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: "–ú–æ–π –∫–æ–ª–ª–µ–≥–∞ –ø–æ–ª–Ω—ã–π –∏–¥–∏–æ—Ç"
  When –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  Then Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ
  And LLM –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç "inappropriate" —Å severity "medium"
  And –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∞–ª–µ—Ä—Ç —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π
```

---

### 6.2. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```python
# tests/fixtures/test_data.py

TEST_MESSAGES = [
    {
        "text": "–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
        "expected_incidents": 0
    },
    {
        "text": "–ù–∞—à API –∫–ª—é—á: sk-proj-abc123xyz",
        "expected_incidents": 1,
        "expected_category": "leak",
        "expected_severity": "high"
    },
    {
        "text": "–ö—É–ø–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É –ø–æ —Å—Å—ã–ª–∫–µ: bit.ly/scam",
        "expected_incidents": 1,
        "expected_category": "spam"
    },
    {
        "text": "–¢—ã –ø–æ–ª–Ω—ã–π –¥–µ–±–∏–ª, —É–≤–æ–ª—å—Å—è!",
        "expected_incidents": 1,
        "expected_category": "inappropriate",
        "expected_severity": "high"
    },
    {
        "text": "–ö—Ç–æ —Å–º–æ—Ç—Ä–µ–ª –≤—á–µ—Ä–∞ —Ñ—É—Ç–±–æ–ª?",
        "expected_incidents": 1,
        "expected_category": "off_topic",
        "expected_severity": "low"
    }
]

async def populate_test_chat(chat_id: int, client: TelegramClient):
    """–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —á–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏"""
    for msg_data in TEST_MESSAGES:
        await client.send_message(chat_id, msg_data["text"])
        await asyncio.sleep(1)
```

---

### 6.3. –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
# src/utils/logger.py

from loguru import logger
import sys

def setup_logger():
    logger.remove()  # –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Ö—ç–Ω–¥–ª–µ—Ä–∞
    
    # –ö–æ–Ω—Å–æ–ª—å (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
    logger.add(
        sys.stdout,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
        level="INFO"
    )
    
    # –§–∞–π–ª (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
    logger.add(
        "logs/app_{time:YYYY-MM-DD}.log",
        rotation="00:00",  # –ù–æ–≤—ã–π —Ñ–∞–π–ª –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
        retention="30 days",
        level="DEBUG",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level} | {name}:{function}:{line} - {message}",
        serialize=True  # JSON —Ñ–æ—Ä–º–∞—Ç
    )
    
    # –§–∞–π–ª –æ—à–∏–±–æ–∫
    logger.add(
        "logs/errors_{time:YYYY-MM-DD}.log",
        rotation="10 MB",
        level="ERROR",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level} | {name}:{function}:{line} - {message}",
        backtrace=True,
        diagnose=True
    )

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
from src.utils.logger import logger

logger.info("Starting scan cycle", extra={"chat_count": 30})
logger.error("API timeout", extra={"endpoint": "/v1/chat/completions", "timeout": 60})
```

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
```python
# src/utils/metrics.py

from dataclasses import dataclass
from datetime import datetime

@dataclass
class ScanMetrics:
    """–ú–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    start_time: datetime
    end_time: datetime
    duration_seconds: float
    chats_processed: int
    messages_collected: int
    voices_transcribed: int
    incidents_found: int
    errors_count: int
    api_calls: dict  # {"whisper": 10, "llm": 50}
    
    def to_prometheus_format(self) -> str:
        """–≠–∫—Å–ø–æ—Ä—Ç –≤ Prometheus —Ñ–æ—Ä–º–∞—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"""
        return f"""
# HELP telegram_monitor_scan_duration_seconds Duration of scan cycle
# TYPE telegram_monitor_scan_duration_seconds gauge
telegram_monitor_scan_duration_seconds {self.duration_seconds}

# HELP telegram_monitor_chats_processed Total chats processed
# TYPE telegram_monitor_chats_processed counter
telegram_monitor_chats_processed {self.chats_processed}

# HELP telegram_monitor_incidents_found Incidents found
# TYPE telegram_monitor_incidents_found counter
telegram_monitor_incidents_found {self.incidents_found}
"""
```

---

### 6.4. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (unit + integration + E2E)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, –ª–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] .env —Ñ–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] .gitignore –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∏ —Å–µ—Å—Å–∏–∏
- [ ] –°–µ—Å—Å–∏—è Telethon —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–µ –ª–∏—á–Ω–æ–≥–æ)
- [ ] Google Sheets –¥–æ—Å—Ç—É–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω, service account –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞
- [ ] APScheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] Bot long polling —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] FloodWait –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] API timeout –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É
- [ ] –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] SQLite –±–∞–∑–∞ –∏–º–µ–µ—Ç –∏–Ω–¥–µ–∫—Å—ã
- [ ] Sheets –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç—Å—è (–µ—Å—Ç—å –∞—Ä—Ö–∏–≤–∞—Ü–∏—è –∏–ª–∏ —Ä–æ—Ç–∞—Ü–∏—è)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- [ ] –ö–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç 24+ —á–∞—Å–∞ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –ø–æ–Ω—è—Ç–Ω–∞

---

## 7. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

### 7.1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ**:
- CPU: 2 —è–¥—Ä–∞
- RAM: 4 GB
- Disk: 20 GB SSD
- OS: Ubuntu 22.04 LTS
- Python: 3.11+

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ (–¥–ª—è 30 —á–∞—Ç–æ–≤)**:
- CPU: 4 —è–¥—Ä–∞
- RAM: 8 GB
- Disk: 50 GB SSD

### 7.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/company/telegram-monitor.git
cd telegram-monitor

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.11 -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
mkdir -p data/sessions data/temp logs

# 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
cp config/.env.example config/.env
nano config/.env  # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

# 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ service_account.json –∏–∑ Google Cloud Console
mv ~/Downloads/service_account.json config/

# 7. –ü–µ—Ä–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telethon (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
python -c "from src.collector.client import TelethonCollector; import asyncio; asyncio.run(TelethonCollector().start_session())"
# –í–≤–æ–¥ –∫–æ–¥–∞ –∏–∑ Telegram

# 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python -c "from config.settings import settings; print(settings.telethon.api_id)"
```

### 7.3. –ó–∞–ø—É—Å–∫

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (foreground)**:
```bash
python main.py
```

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω (systemd service)**:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ systemd unit
sudo nano /etc/systemd/system/telegram-monitor.service
```

```ini
[Unit]
Description=Telegram Monitor Service
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/telegram-monitor
Environment="PATH=/home/ubuntu/telegram-monitor/venv/bin"
ExecStart=/home/ubuntu/telegram-monitor/venv/bin/python main.py
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
sudo systemctl daemon-reload
sudo systemctl enable telegram-monitor
sudo systemctl start telegram-monitor

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status telegram-monitor

# –õ–æ–≥–∏
journalctl -u telegram-monitor -f
```

### 7.4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏**:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "python main.py"

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f logs/app_$(date +%Y-%m-%d).log

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ SQLite
sqlite3 data/local_db.sqlite "SELECT COUNT(*) FROM scan_logs WHERE status='completed' AND DATE(start_time) = DATE('now');"

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å /status –≤ Telegram –±–æ—Ç—É
```

**Alerts (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
async def send_health_alert():
    last_scan = await db.get_last_scan_log()
    if (datetime.now() - last_scan.start_time).total_seconds() > 7 * 3600:
        # –ë–æ–ª–µ–µ 7 —á–∞—Å–æ–≤ –±–µ–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è - –ø—Ä–æ–±–ª–µ–º–∞
        await notifier.send_message(
            admin_id,
            "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ 7 —á–∞—Å–æ–≤!"
        )
```

### 7.5. Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

**Backup**:
```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups/telegram-monitor"

# SQLite
cp data/local_db.sqlite "$BACKUP_DIR/db_$DATE.sqlite"

# –°–µ—Å—Å–∏—è Telethon
cp data/sessions/userbot.session "$BACKUP_DIR/session_$DATE.session"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
cp config/.env "$BACKUP_DIR/env_$DATE.txt"
cp config/service_account.json "$BACKUP_DIR/sa_$DATE.json"

# –õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
tar -czf "$BACKUP_DIR/logs_$DATE.tar.gz" logs/*.log

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (> 30 –¥–Ω–µ–π)
find "$BACKUP_DIR" -type f -mtime +30 -delete
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00)
0 3 * * * /home/ubuntu/telegram-monitor/backup.sh
```

---

### 7.6. Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞ | –°–∏–º–ø—Ç–æ–º—ã | –†–µ—à–µ–Ω–∏–µ |
|----------|----------|---------|
| **Userbot –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è** | `SessionPasswordNeededError` | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é: `python scripts/reauth.py` |
| **FloodWait –ø–æ—Å—Ç–æ—è–Ω–Ω–æ** | –õ–æ–≥–∏ –ø–æ–ª–Ω—ã `FloodWaitError` | –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ config: `FLOOD_DELAY_MIN=30, MAX=60` |
| **LLM –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã** | `incidents_found=0` –≤—Å–µ–≥–¥–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–ø—Ç, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã, —Å–Ω–∏–∑–∏—Ç—å `temperature` |
| **Sheets quota exceeded** | `APIError: RATE_LIMIT_EXCEEDED` | –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø–∏—Å–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞—Ç—á–∏–Ω–≥ |
| **–ì–æ–ª–æ—Å–æ–≤—ã–µ –Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è** | –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ `download_media` | –£–≤–µ–ª–∏—á–∏—Ç—å `VOICE_DOWNLOAD_TIMEOUT`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å —Å–µ—Ç–∏ |
| **–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç** | `/status` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `BOT_TOKEN`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å polling |
| **SQLite –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** | `database is locked` | –î–æ–±–∞–≤–∏—Ç—å `timeout=30` –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WAL mode |

---

## –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | 185 —á–∞—Å–æ–≤ (~23 –¥–Ω—è –ø—Ä–∏ 8—á/–¥–µ–Ω—å) |
| **MVP –≥–æ—Ç–æ–≤ —á–µ—Ä–µ–∑** | 12 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π |
| **–ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–µ—Ä–µ–∑** | 23 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–æ—Ü–µ–Ω–∫–∞)** | ~3500-4000 LOC |
| **–§–∞–π–ª–æ–≤ Python** | ~25-30 |
| **–¢–µ—Å—Ç–æ–≤ (–º–∏–Ω–∏–º—É–º)** | 50+ |
| **–†–∞–∑–º–µ—Ä requirements.txt** | 10 –±–∏–±–ª–∏–æ—Ç–µ–∫ |

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä main.py

```python
# main.py

import asyncio
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from loguru import logger

from config.settings import settings
from src.collector.client import TelethonCollector
from src.manager.bot import TelegramBot
from src.scheduler.jobs import ScanJob
from src.storage.database import DatabaseManager
from src.utils.logger import setup_logger

async def main():
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    setup_logger()
    logger.info("Starting Telegram Monitor System")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
    db_manager = DatabaseManager()
    await db_manager.init_db()
    logger.info("Database initialized")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telethon (–±–µ–∑ –∑–∞–ø—É—Å–∫–∞)
    collector = TelethonCollector(
        api_id=settings.telethon.api_id,
        api_hash=settings.telethon.api_hash,
        phone=settings.telethon.phone
    )
    logger.info("Telethon collector initialized")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bot
    bot = TelegramBot(
        token=settings.aiogram.bot_token,
        admin_id=settings.aiogram.admin_id
    )
    logger.info("Telegram bot initialized")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Scheduler
    scheduler = AsyncIOScheduler()
    scan_job = ScanJob(collector, bot)
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
    scheduler.add_job(
        scan_job.run,
        trigger='interval',
        hours=settings.app.scan_interval_hours,
        id='main_scan',
        replace_existing=True,
        max_instances=1
    )
    logger.info(f"Scan job scheduled every {settings.app.scan_interval_hours} hours")
    
    # –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    scheduler.start()
    logger.info("Scheduler started")
    
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (blocking)
    try:
        await bot.start_polling()
    except KeyboardInterrupt:
        logger.info("Shutting down...")
    finally:
        scheduler.shutdown()
        await collector.stop_session()
        logger.info("Shutdown complete")

if __name__ == "__main__":
    asyncio.run(main())
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Telethon –∏ aiogram. –ü–ª–∞–Ω –≤–∫–ª—é—á–∞–µ—Ç:

‚úÖ **–î–µ—Ç–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏  
‚úÖ **–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π** —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞  
‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö** (SQLite —Å—Ö–µ–º—ã, Pydantic –º–æ–¥–µ–ª–∏, Google Sheets)  
‚úÖ **–ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π MVP  
‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (unit, integration, E2E)  
‚úÖ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é** –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏  

–°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º:
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏**: 30+ —á–∞—Ç–æ–≤ –±–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç–∏**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, retry –º–µ—Ö–∞–Ω–∏–∑–º—ã, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –ò–∑–æ–ª—è—Ü–∏—è userbot, anti-flood, secrets management
- **Maintainability**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**: –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≠—Ç–∞–ø–∞ 1 (MVP), —Å–ª–µ–¥—É—è —á–µ–∫-–ª–∏—Å—Ç—É –∑–∞–¥–∞—á –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 5.